<script>
  const params = new URLSearchParams(window.location.search);
  const code = params.get("code");
  const state = params.get("state");

  if (code && window.opener) {
    window.opener.postMessage({ spotify_code: code, uuid: state }, "*");

    let seconds = 5;
    const message = document.createElement("p");
    message.id = "countdown";
    message.innerText = `This window will close in ${seconds} seconds.`;
    document.body.appendChild(message);

    const interval = setInterval(() => {
      seconds--;
      if (seconds <= 0) {
        clearInterval(interval);
        window.close();
      } else {
        message.innerText = `This window will close in ${seconds} seconds.`;
      }
    }, 1000);

    document.body.innerHTML = `
      <h2>Spotify Authorization Complete</h2>
      <p>Authorization code has been sent to the main app.</p>
    `;
    document.body.appendChild(message);
  } else {
    document.body.textContent = "No code found in the URL.";
  }
</script>

